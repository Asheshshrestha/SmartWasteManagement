if (self.CavalryLogger) { CavalryLogger.start_js(["PjmsA"]); }

__d("PhotoAlbumAudienceInput",["Arbiter","CSS","DOM","Event","gkx"],(function(a,b,c,d,e,f){__p&&__p();a=function(){"use strict";__p&&__p();function a(a,c,d,e,f){var g=this;this.$7=!1;this.$9=function(){if(g.$6==null||typeof g.$6.removeAllTokens!=="function")return;g.$6.removeAllTokens();g.$10(null,null)};this.$1=a;c&&(this.$2=c,this.$3=d,this.$5=e,this.$4=f,b("Arbiter").subscribe("Tokenizer/init",this.$8.bind(this)),this.$5!=null&&!b("gkx")("777107")&&b("Event").listen(this.$5,"click",this.$9))}var c=a.prototype;c.isSharedSelectorActive=function(){return this.$2==null?!1:this.$7};c.getNormalPrivacyWidget=function(){return this.$1};c.getSharedPrivacyWidget=function(){return this.$2};c.removeHiddenPrivacyWidget=function(){[this.$1,this.$2,this.$4].forEach(function(a){a&&b("CSS").hasClass(a,"hidden_elem")&&b("DOM").remove(a)})};c.$8=function(a,c){if(this.$6||this.$3!=c.element)return;this.$6=c;this.$10(null,null);b("Arbiter").subscribe("Form/change",this.$10.bind(this))};c.$10=function(a,b){if(this.$6==null||typeof this.$6.getTokens!=="function")return;a=this.$6.getTokens().length>0;this.$11(a)};c.$11=function(a){this.$7=a,this.$2&&b("CSS").conditionShow(this.$2,a),this.$1&&b("CSS").conditionShow(this.$1,!a),this.$4&&b("CSS").conditionShow(this.$4,a)};return a}();e.exports=a}),null);
__d("PhotoAlbumPlacesTypeahead",["Arbiter"],(function(a,b,c,d,e,f){__p&&__p();a=function(){"use strict";__p&&__p();function a(a){__p&&__p();if(!a)return;if(a.getCore().getHiddenValue()){var c={uid:a.getCore().getHiddenValue(),text:a.getCore().getValue()};b("Arbiter").inform("PhotoAlbumPlacesTypeahead.EXIST_PLACE",c)}a.subscribe("select",function(c,a){b("Arbiter").inform("PhotoAlbumPlacesTypeahead.SELECTED_PLACE",a.selected)}.bind(this));a.subscribe("reset",function(){a.getCore().getHiddenValue()||b("Arbiter").inform("PhotoAlbumPlacesTypeahead.RESET_PLACE")}.bind(this));a.subscribe("focus",function(){b("Arbiter").inform("PhotoAlbumPlacesTypeahead.FOCUSED")}.bind(this));this._initialized=!0}var c=a.prototype;c.init=function(b){if(this._initialized)return;a.call(this,b)};return a}();e.exports=a}),null);
__d("PersistentAlbumDataStore",["WebStorage"],(function(a,b,c,d,e,f){__p&&__p();var g,h="fb_album_recovery",i=7*60*60*24,j={_storageExists:!0,_initializeWebStorage:function(){var a=(g||(g=b("WebStorage"))).getLocalStorage();if(!a){j._storageExists=!1;return}a.getItem(h)||a.setItem(h,JSON.stringify({}))},_getAlbumsObject:function(){if(!j._storageExists)return{};j._initializeWebStorage();return JSON.parse((g||(g=b("WebStorage"))).getLocalStorage().getItem(h))},_setAlbumsObject:function(a){if(!j._storageExists)return;j._initializeWebStorage();(g||(g=b("WebStorage"))).getLocalStorage().setItem(h,JSON.stringify(a))},_getLocalStorageByAlbum:function(a){return j._getAlbumsObject()[a]||j.createAlbum(a)},_setLocalStorageByAlbum:function(a,b){var c=j._getAlbumsObject();c[a]=b;j._setAlbumsObject(c)},createAlbum:function(a){var b={privacy:null,tags:{},created_at:Date.now()};j._setLocalStorageByAlbum(a,b);return b},deleteAlbum:function(a){var b=j._getAlbumsObject();delete b[a];j._setAlbumsObject(b)},getAlbumPrivacy:function(a){return j._getLocalStorageByAlbum(a).privacy},setAlbumPrivacy:function(a,b){var c=j._getLocalStorageByAlbum(a);c.privacy=b;j._setLocalStorageByAlbum(a,c)},saveTag:function(a,b,c){var d=j._getLocalStorageByAlbum(a);d.tags[b]||(d.tags[b]=[]);c.recovered=!0;d.tags[b].push(c);j._setLocalStorageByAlbum(a,d)},removeTag:function(a,b,c){var d=j._getLocalStorageByAlbum(a),e=d.tags[b]||[];for(var f=0;f<e.length;f++)if(e[f].subject===c||e[f].name===c){e.splice(f,1);break}d.tags[b]=e;j._setLocalStorageByAlbum(a,d)},getTags:function(a,b){return j._getLocalStorageByAlbum(a).tags[b]||[]},deleteExpiredAlbums:function(){var a=j._getAlbumsObject();for(var b in a){var c=a[b];Date.now()-c.created_at>i*1e3&&j.deleteAlbum(b)}}};e.exports=j}),null);
__d("PhotoBulkEditTagger",["csx","Arbiter","AsyncRequest","CSS","DOM","DOMQuery","Event","FaceboxSourceConstants","Parent","PersistentAlbumDataStore","PhotosConst","PhotosTaggingWaterfall","PhotoTagger","PhotoTagStore","SubscriptionsHandler","Vector","$","ge"],(function(a,b,c,d,e,f,g){__p&&__p();var h=60;a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d,e,f){__p&&__p();var g;g=a.call(this,c)||this;g.editor=c;g.faceboxes=[];g._qn=f.qn;g.tokenizer=e;g.editor.registerTagger(babelHelpers.assertThisInitialized(g));g.typeahead=e.getTypeahead();g.handlers=new(b("SubscriptionsHandler"))();g.root=g.editor.getRoot();g.tagger=d;g.hideNewTagTimer=null;g.photoKey=null;g._needTaggingData=!0;g._currentRecognition={box:null,isTagged:!1,suggestion:null};g._hoverState=!1;g._tagging=!1;g.setupHandlers();g._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").BEGIN);g.fetchTaggingSuggestions();g.setTagAccumulator(f.bulkSaveTags);g.setNeedTaggingData(f.needTaggingData);g.version=b("PhotosConst").BULK_EDITOR;b("Event").listen(g.root,"mousemove",function(a){a=a.getTarget();this._hoverState&&!(b("Parent").byClass(a,"faceBox")||b("Parent").byClass(a,"tagPointer")||b("Parent").byClass(a,"arrow")||b("Parent").byClass(a,"faceboxSuggestion"))&&(this.removeSuggestionFromTagger(),this.hideTagger())}.bind(babelHelpers.assertThisInitialized(g)));return g}var d=c.prototype;d.setupUserActionLogging=function(){return null};d.logUserActionEvent=function(a){return null};d.addFaceboxes=function(a){__p&&__p();var c=this;this.faceboxes=b("DOMQuery").scry(a.parentNode,".faceBox");this.faceboxes.sort(function(a,b){return a.offsetLeft===b.offsetLeft?a.offsetTop-b.offsetTop:a.offsetLeft-b.offsetLeft});var d=b("Parent").byClass(a,"editablePhoto"),e=b("PhotoTagStore").getInstance().getPhotoTags(d.getAttribute("data-photoid")),f=[];Object.keys(e).forEach(function(a){e[a].fbid&&(f[e[a].fbid]=!0)});this.faceboxes.forEach(function(d){var g=c.getFaceboxSuggestionFromFaceboxElem(d),h=d.getAttribute("data-faceboxid");if(g&&e[g.getAttribute("data-id")]||f[h]){b("DOM").remove(d);return}g={image:a,facebox:d};b("Event").listen(d,"mouseenter",c._mouseOverFacebox.bind(c,g))})};d.saveTag=function(c,d,e){if(!d.info.recovered){a.prototype.saveTag.call(this,c,d,e);c=this.getTaggingDataForSave(d,e);b("PersistentAlbumDataStore").saveTag(this.photoData.albumFBID,this.photoData.fbid,c)}b("Arbiter").inform("PhotoBulkEditTagger.TAG_SAVED",{editor:this.root,fbid:this.photoData.fbid})};d.recoverPhoto=function(a){var c=this;this.setupPhotoDataForTarget(a.getRoot());a=b("PersistentAlbumDataStore").getTags(this.photoData.albumFBID,this.photoData.fbid);a.forEach(function(a){var d=c.tokenizer.createToken({uid:a.subject?a.subject:a.name,text:a.name,suggestion:a.from_facebox,freeform:a.subject==="",recovered:!0});c.tokenizer.addToken(d);b("PhotoTagStore").getInstance().storeTagWithOptions(c.photoData.fbid,a.subject,a.x,a.y,a)})};d.setNeedTaggingData=function(a){this._needTaggingData=a;return this};d.setTagAccumulator=function(b){a.prototype.setTagAccumulator.call(this,b);return this};d.needTaggingData=function(){return this._needTaggingData};d.setupHandlers=function(){b("Event").listen(this.root,"click",this.clickHandler.bind(this)),this.tokenizer.subscribe(["addToken","removeToken"],this.handleTokenAction.bind(this)),this.tokenizer.subscribe("switchTarget",this.switchPhoto.bind(this)),this.tokenizer.subscribe("initialized",this.editor._recoverPhotos.bind(this.editor)),b("Arbiter").subscribe("PhotoBulkEditTagger.DATA_SOURCE_READY",this.useTaggingDataSource.bind(this)),b("Arbiter").subscribe(this.editor.mapEventNameToNamespace("PhotosBulkEditor.PHOTO_REORDER_START"),this.hideTagger.bind(this))};d.hideTagger=function(){a.prototype.hideTagger.apply(this,arguments),this._currentRecognition.box&&!this._currentRecognition.isTagged&&b("CSS").show(this._currentRecognition.box),this._tagging=!1,this._hoverState=!1,this._currentRecognition.box=null,this._currentRecognition.isTagged=!1,this._currentRecognition.suggestion=null,this.recognizedUsers=[]};d.done=function(){this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").FINISH)};d.handleTokenAction=function(a,c){__p&&__p();var d=b("$")(this.photoKey),e=b("DOM").find(d,".peopleIcon");d=b("DOM").find(d,".editablePhotoTagList");var f=b("DOM").find(e,".count"),g=this.tokenizer.getTokens().length,h=c.info.suggestion?b("FaceboxSourceConstants").UPLOADER_SUGGEST:null;this._currentRecognition.box&&(this._currentRecognition.isTagged=!!g);b("CSS").conditionClass(e,"hasPeople",!!g);b("CSS").conditionClass(d,"hasPeople",!!g);b("DOM").setContent(f,g);if(a=="addToken"){this.saveTag(a,c,h);return}else this.removeTag(a,c),b("PersistentAlbumDataStore").removeTag(this.photoData.albumFBID,this.photoData.fbid,c.info.uid),b("Arbiter").inform("PhotoBulkEditTagger.TAG_REMOVED",{editor:this.root,fbid:this.photoData.fbid})};d.useTaggingDataSource=function(a,b){if(!this._needTaggingData)return;a=this.tokenizer.getTypeahead();a.swapData(b);this.setNeedTaggingData(!1)};d.getTaggerPositioningOrigin=function(){return b("Vector").getElementPosition(this.root)};d.getRecognitionBoxCenter=function(a,c){a=b("Vector").getElementPosition(a).add(b("Vector").getElementDimensions(a).mul(.5));var d=b("Vector").getElementDimensions(this._currentRecognition.box);c=this.calcTaggerPosition(c,a,d.x,d.y);return{boxPos:a,boxDim:d,taggerPos:c}};d.setUpTagger=function(a,c,d,e,f){this.calcClickPoint(a,d),f.setElementPosition(this.tagger),e&&e.setElementDimensions(this.tagger),b("CSS").hide(b("DOM").find(c,".clickToTagMessage")),this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").TAG_FACE),this.updateTypeaheadSuggestions(),this.updateWithSuggestions(),this.showTagger(),this._tagging=!0};d.clickHandler=function(a){__p&&__p();var c=a.getTarget();if(b("Parent").byClass(c,"photoTagTypeahead"))return;if(this._hoverState){this._hoverState=!1;this._tagging=!0;return}this.tagger&&(this.hideTagger(),this.removeSuggestionFromTagger(),this.handlers.release());if(b("Parent").byClass(c,"photoContextualSelector")||b("Parent").byClass(c,"removePhotoButton"))return;var d=b("Parent").byClass(c,"editablePhotoImage");if(!d){var e=b("Parent").byClass(c,"peopleIcon");e&&this.setupPhotoDataForTarget(e);return}if(b("DOMQuery").scry(d,".clickToTagMessage").length===0)return;this.setupPhotoDataForTarget(d);e=b("DOM").find(d,".scaledImage img");var f=null,g=null,i=null,j=b("Parent").byClass(c,"faceBox");j||(j=b("Parent").byClass(c,"recognitionBox"));this._currentRecognition.box=j;if(this._currentRecognition.box&&b("CSS").shown(this._currentRecognition.box)){c=this.getRecognitionBoxCenter(j,e);f=c.boxPos;g=c.boxDim;i=c.taggerPos;b("CSS").hide(this._currentRecognition.box);this._currentRecognition.isTagged=!1;c=this.getFaceboxSuggestionFromFaceboxElem(j);c?(this._currentRecognition.suggestion=c,this.addSuggestionToTagger(j,c),this._sendFaceboxSuggestionLogSignal(c.getAttribute("data-id"),b("FaceboxSourceConstants").UPLOADER_SUGGEST)):this.recognizedUsers=JSON.parse(j.getAttribute("data-recognizeduids"))}i===null&&(f=b("Vector").getEventPosition(a),i=this.calcTaggerPosition(e,f,h));if(!i)return;this.setUpTagger(e,d,f,g,i)};d._mouseOverFacebox=function(a){__p&&__p();if(this._tagging)return;var c=a.image;a=a.facebox;var d=this.getFaceboxSuggestionFromFaceboxElem(a);if(d){this._hoverState=!0;this._currentRecognition.box=a;this._currentRecognition.suggestion=d;this.setupPhotoDataForTarget(c);this.addSuggestionToTagger(a,d);this._sendFaceboxSuggestionLogSignal(d.getAttribute("data-id"),b("FaceboxSourceConstants").UPLOADER_SUGGEST);this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").HOVER_TAG_FACE);d=b("Vector").getElementPosition(a).add(b("Vector").getElementDimensions(a).mul(.5));a=b("Vector").getElementDimensions(this._currentRecognition.box);var e=this.calcTaggerPosition(c,d,a.x,a.y);this.calcClickPoint(c,d);e.setElementPosition(this.tagger);a.setElementDimensions(this.tagger);this.showTagger()}};d.fetchTaggingSuggestions=function(){this.logUserActionEvent("sugg_fetch"),new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagsInit).setData({owner:this.photoData.owner}).setOption("retries",1).setHandler(function(a){a=a.getPayload();this.featuredSuggestions=a.featuredTaggees;this.friendSuggestions=a.friendTaggees;this.logUserActionEvent("sugg_fetch_done")}.bind(this)).send()};d.switchPhoto=function(a,c){a=b("ge")(c);a&&this.setupPhotoDataForTarget(a);this.hideTagger()};d.getImageByID=function(a){return b("ge")("editablePhoto_"+a)};d.setupPhotoDataForTarget=function(a){__p&&__p();var c;a&&!b("CSS").hasClass(a,"editablePhoto")?c=b("Parent").byClass(a,"editablePhoto"):c=a;if(!c){this.photoKey=null;this.photoData=null;return!1}a=c.id;if(a===this.photoKey)return;this.photoKey=a;this.photoData=this.editor.getPhotoData(a);this.tokenizer.setTokenarea(b("DOM").find(c,"div.editablePhotoTagList"))};d.getPosition=function(){return this.photoData.fbid};d.tagsChangeHandler=function(a){};d.removeTagByID=function(b,c,d){this.hideTagger(),this.setupPhotoDataForTarget(this.getImageByID(b)),a.prototype.removeTagByID.call(this,b,c,d)};d.setupFaceboxSuggestionHandlers=function(a,c){var d=b("DOM").find(c,"._570w"),e=b("DOM").find(c,"._570x");this.handlers.engage();this.handlers.addSubscriptions(b("Event").listen(d,"click",function(d){this.dismissFaceboxSuggestion(a.id.replace("face:",""),c.getAttribute("data-id"),this.photoData.owner,b("FaceboxSourceConstants").UPLOADER_DISMISS),this.removeSuggestionFromTagger(),this.hideTagger(),b("DOM").remove(this.getFaceboxSuggestionFromFaceboxElem(a))}.bind(this)),b("Event").listen(e,"click",function(d){d=this.tokenizer.createToken({uid:c.getAttribute("data-id"),text:c.getAttribute("data-text"),suggestion:!0});this.removeSuggestionFromTagger();b("CSS").hide(a);this.tokenizer.addToken(d)}.bind(this)))};return c}(b("PhotoTagger"));Object.assign(a.prototype,{elemNames:{}});e.exports=a}),null);
__d("PhotoBulkEditTokenizer",["DOM","Event","Input","Parent","Tokenizer","UserAgent_DEPRECATED","getObjectValues"],(function(a,b,c,d,e,f){__p&&__p();a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.init=function(b,c,d,e){this._tokenareaListeners={},a.prototype.init.call(this,b,c,d,e),this.inform("initialized")};d.initEvents=function(){var a=b("UserAgent_DEPRECATED").firefox()<4?"keypress":"keydown";b("Event").listen(this.input,"paste",this.paste.bind(this));b("Event").listen(this.input,a,this.keydown.bind(this))};d.setTokenarea=function(a){this.tokenarea=a,this.addTokenareaListener(a),this.reset()};d.addTokenareaListener=function(a){if(this._tokenareaListeners[a.id])return;var c=this.handleEvents.bind(this);this._tokenareaListeners[a.id]=b("getObjectValues")(b("Event").listen(a,{click:c,keydown:c}))};d.handleEvents=function(c){var d=b("Parent").byClass(c.getTarget(),"editablePhotoTagList");if(!d)return;else this.tokenarea!==d&&(this.setTokenarea(d),this.inform("switchTarget",this.tokenarea.id));return a.prototype.handleEvents.call(this,c)};d.reset=function(){var c=this.getTokenElements().map(function(a){return{uid:b("DOM").scry(a,"input")[0].value,text:b("DOM").scry(a,"input")[1].value}});b("Input").reset(this.input);return a.prototype.reset.call(this,c)};d.updateTokenareaVisibility=function(){return null};d.insertToken=function(a){b("DOM").prependContent(this.tokenarea,a.getElement())};return c}(b("Tokenizer"));e.exports=a}),null);
__d("ProgressiveDatepicker",["Arbiter","ArbiterMixin","CSS","DataStore","DOM","Event","Focus","Parent","getElementText","mixin","shield"],(function(a,b,c,d,e,f){__p&&__p();function g(a){return new Date(a[0],a[1],a[2],a[3],a[4])}function h(a,c){while(a.length)b("DOM").insertAfter(c,a.pop())}a=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d){__p&&__p();var e;e=a.call(this)||this;e._root=c;e._savedLabels={};e._savedPeriodsBack=[];e._savedPeriodsFront=[];e._menus={};e._dayOrderAscending=d.dayorderascending;var f=0;d.gmtoffset!==void 0&&(f=-new Date().getTimezoneOffset()-d.gmtoffset);e._mintime=d.mintime&&new Date(1e3*d.mintime-f*6e4);e._maxtime=d.maxtime&&new Date(1e3*d.maxtime-f*6e4);b("DataStore").set(c,"datepicker",babelHelpers.assertThisInitialized(e));b("DOM").scry(c,"select").forEach(function(a){b("Event").listen(a,"change",b("shield")(this._handleChange,this,a));var c=b("Parent").byClass(a,"period");b("Event").listen(a,"focus",b("CSS").addClass.bind(null,c,"periodFocus"));b("Event").listen(a,"blur",b("CSS").removeClass.bind(null,c,"periodFocus"));this._setMenuSelectionState(a);a.getAttribute("data-name")==="month"&&this._filterInvalidDates()}.bind(babelHelpers.assertThisInitialized(e)));b("DOM").scry(c,"a.periodLabel").forEach(function(a){var c=b("Parent").byClass(a,"period");b("Event").listen(a,"click",function(){b("CSS").addClass(c,"periodSelected"),b("CSS").addClass(c,"periodFocus"),b("Focus").set(b("DOM").find(c,"select"))})});e._filterInvalidDates();e.inform("initialized",babelHelpers.assertThisInitialized(e),"state");return e}var d=c.prototype;d.setDate=function(a,b,d,e,f){this._addSavedPeriods();var g=c.PERIODS;for(var h=0;h<g.length;h++)this._setValueForPeriod(g[h],arguments[h]);this._filterInvalidDates();this.inform("changed")};d.setDateWithTimestamp=function(a){a=new Date(a);this.setDate(a.getFullYear(),a.getMonth()+1,a.getDate(),a.getHours(),a.getMinutes())};d.isSet=function(){var a=c.PERIODS;for(var b=0;b<a.length;b++)if(this._getValueForPeriod(a[b]))return!0;return!1};d.getRoot=function(){return this._root};d.getValues=function(){var a=c.PERIODS,b={};for(var d=0;d<a.length;d++){var e=this._getValueForPeriod(a[d]);e&&(b[a[d]]=e)}return b};d.getDate=function(){var a=this.getValues();return new Date(a.year||0,(a.month||1)-1,a.day||1,a.hour||0,a.minute||0)};d.getTimestamp=function(){return Math.round(this.getDate().getTime()/1e3)};d._setValueForPeriod=function(a,b){__p&&__p();a=this._menuForPeriodName(a);if(!a)return;b===void 0&&(b="");var c=a.options;for(var d=0,e=c.length;d<e;d++)if(c[d].value==b){a.selectedIndex=d;break}this._setMenuSelectionState(a)};d._getValueForPeriod=function(a){a=this._menuForPeriodName(a);return a&&a.options[a.selectedIndex].value};d._handleChange=function(a){this._setMenuSelectionState(a),this._filterInvalidDates(),this.inform("changed")};d._setMenuSelectionState=function(a){var d=b("Parent").byClass(a,"period");if(!d)return;b("CSS").hasClass(d,"periodRequired")?a.selectedIndex===0&&(a.selectedIndex=1):this._updateLabel(a);var e=a.getAttribute("data-name");a=a.options[a.selectedIndex].value;b("CSS").conditionClass(d,"periodSelected",a);b("CSS").conditionClass(this._root,this._selectedClass(e),a);a||this._resetMenu(c.PERIODS.indexOf(e)+1)};d._updateLabel=function(a){var c=a.getAttribute("data-name"),d=a.options[0];this._savedLabels[c]||(this._savedLabels[c]=b("getElementText")(d));a.selectedIndex===0?b("DOM").setContent(d,this._savedLabels[c]):b("DOM").setContent(d,"--")};d._daysInMonth=function(a,b){return new Date(a||1999,b+1||1,0).getDate()};d._daysInCurrentMonth=function(){return this._daysInMonth(this._getValueForPeriod("year"),this._getValueForPeriod("month")-1)};d._menuForPeriodName=function(a){this._menus[a]||(this._menus[a]=b("DOM").scry(this._root,"."+a+"Menu")[0]);return this._menus[a]};d._selectedClass=function(a){return"uiProgressiveDatepickerSelected-"+a};d._resetMenu=function(a){var d=c.PERIODS;for(;a<d.length;a++){var e=d[a],f=this._menuForPeriodName(e);if(!f)return;b("Parent").byClass(f,"periodRequired")?f.selectedIndex=1:(b("CSS").removeClass(b("Parent").byClass(f,"period"),"periodSelected"),b("CSS").removeClass(this._root,this._selectedClass(e)),f.selectedIndex=0,this._updateLabel(f))}};d._addSavedPeriods=function(){__p&&__p();var a=c.PERIODS;for(var b=0;b<a.length;b++){var d=this._menuForPeriodName(a[b]);if(!d)return;this._savedPeriodsFront[b]||(this._savedPeriodsFront[b]=[]);this._savedPeriodsBack[b]||(this._savedPeriodsBack[b]=[]);var e=d.options[0];d=d.options[d.options.length-1];b===c.PERIODS.indexOf("hour")||b===c.PERIODS.indexOf("minute")||b===c.PERIODS.indexOf("day")&&this._dayOrderAscending?(h(this._savedPeriodsFront[b],e),h(this._savedPeriodsBack[b],d)):(h(this._savedPeriodsBack[b],e),h(this._savedPeriodsFront[b],d))}};d._filterInvalidDates=function(){__p&&__p();this._addSavedPeriods();var a=c.PERIODS,d=this.getValues();for(var e=0;e<a.length;e++){var f=this._menuForPeriodName(a[e]);if(!f)return;this._savedPeriodsFront[e]||(this._savedPeriodsFront[e]=[]);this._savedPeriodsBack[e]||(this._savedPeriodsBack[e]=[]);for(var h=1;h<f.options.length;){var i=f.options[h],j=[e-1>=0?d[a[0]]:0,e-1>=1?d[a[1]]-1:0,e-1>=2?d[a[2]]:1,e-1>=3?d[a[3]]:0,e-1>=4?d[a[4]]:0];j[e]=i.value;e===c.PERIODS.indexOf("month")&&(j[e]=j[e]-1);j=g(j);var k=[e-1>=0?d[a[0]]:9001,e-1>=1?d[a[1]]-1:11,e-1>=2?d[a[2]]:this._daysInCurrentMonth(),e-1>=3?d[a[3]]:23,e-1>=4?d[a[4]]:59];k[e]=i.value;e===c.PERIODS.indexOf("month")&&(k[e]--,k[e+1]=this._daysInMonth(k[0],k[1]));k=g(k);j=j>this._maxtime;k=k<this._mintime;var l=e===c.PERIODS.indexOf("day")&&i.value>this._daysInCurrentMonth();k||j||l?(i.selected&&(i.selected=!1,this._resetMenu(e)),b("DOM").remove(i),j||l?this._savedPeriodsBack[e].push(i):this._savedPeriodsFront[e].push(i)):h++}}};c.getInstance=function(a){return a?b("DataStore").get(a,"datepicker"):null};return c}(b("mixin")(b("ArbiterMixin")));Object.assign(a,{PERIODS:["year","month","day","hour","minute"]});e.exports=a}),null);
__d("PhotosBulkEditablePhoto",["csx","cx","fbt","Arbiter","AsyncDialog","AsyncRequest","AsyncResponse","CSS","Dialog","DOM","Event","Focus","Form","Input","Parent","PhotosConst","PlaceUtils","ProgressiveDatepicker"],(function(a,b,c,d,e,f,g,h,i){__p&&__p();var j=null,k=null,l=!1;a=function(){"use strict";__p&&__p();function a(a,c,d,e,f,g,h){__p&&__p();var i=this;this._root=a;this._mentionsTypeahead=c;this._placesTypeahead=d;this._photoData=e;this._hasOwnPlaceValue=!!d.getCore().getHiddenValue();e=(c=b("DOM")).find(a,".placesInput");var m=c.find(a,".captionTextarea"),n=c.find(d.element,".uiTypeaheadCloseButton");this._metadataInputs=c.find(a,".metadataInputs");this._editorId=f;this._published=g;this._showMove=h;this._photoDataKey=this._root.id;this._hasTimeTaken=!!this._photoData.timeTaken;this._hasExistingDateValue=this._photoData.isBackdated;this._listeners=[(f=b("Event")).listen(a,"click",this._handleClick.bind(this)),f.listen(e,"focus",this._placesFocus.bind(this)),f.listen(m,"focus",this._captionFocus.bind(this)),f.listen(m,"blur",this._save.bind(this)),f.listen(n,"click",function(){setTimeout(i._save.bind(i),0)}),f.listen(a,"submit",function(){return!1})];this._previousSaveData=b("Form").serialize(this._root);g=c.scry(this._root,"div.backdateInput .periodMenu");for(var h=0;h<g.length;h++){e=g[h];this._listeners.push(b("Event").listen(e,"change",function(){return i._saveDate()}))}m=c.scry(this._root,"._2sfm").pop();if(m){n=m.getAttribute("data-direction");this._listeners.push(b("Event").listen(m,"click",this._rotate.bind(this,n)))}f=b("DOM").scry(a,".photoContextualSelector")[0];if(f){e=b("DOM").scry(f,".moveAlbum")[0];e&&this._listeners.push(b("Event").listen(e,"click",this._move.bind(this)));g=b("DOM").scry(f,".albumCover")[0];g&&this._listeners.push(b("Event").listen(g,"click",this._setAlbumCover.bind(this)));h=b("DOM").scry(f,".removePhoto")[0];h&&this._listeners.push(b("Event").listen(h,"click",this.remove.bind(this)))}else{c=b("DOM").find(a,".removePhotoButton");this._listeners.push(b("Event").listen(c,"click",this.remove.bind(this)))}this._placesDataListener=[d.subscribe(["select","reset","render"],function(c,e){b("CSS").conditionClass(i._root,"focusedInput",c=="render");if(c=="render")return;if(c=="reset"&&d.getCore().getHiddenValue())return;e&&e.selected?(j=e.selected,k==j.text?l=!0:(k=j.text,l=!1)):(j=null,k=null,l=!1);i._hasOwnPlaceValue=c=="select";b("CSS").conditionClass(b("DOM").find(a,".placeIcon"),"hasPlace",i._hasOwnPlaceValue);i._hasOwnPlaceValue&&i._save()})];this._placesInputBlurListener=d.getCore().subscribe("blur",function(a,c){b("CSS").removeClass(this._root,"focusedInput")}.bind(this));b("Arbiter").inform(this.mapEventNameToNamespace("PhotosBulkEditablePhoto.INITIALIZED"),this,"persistent")}var c=a.prototype;c.getPhotoDataKey=function(){return this._photoDataKey};c.getPhotoData=function(){return this._photoData};c.getRoot=function(){return this._root};c.getDragHandle=function(){return this.getRoot()};c.getRotateButtonType=function(){return this._rotateButtonType};c.swapData=function(a,b){var c=this._mentionsTypeahead.getData(),d=this._placesTypeahead.getData();c!==a&&this._mentionsTypeahead.swapData(a);if(d!==b){c=this._placesTypeahead.getCore().getValue();a=this._placesTypeahead.getCore().getHiddenValue();this._placesTypeahead.swapData(b);this.hasOwnPlaceValue()&&this._placesTypeahead.getCore().select({text:c,uid:a})}};c.hasOwnPlaceValue=function(){return this._hasOwnPlaceValue};c.setAlbumPlace=function(a,c){this._hasOwnPlaceValue=!1;var d=this._placesTypeahead.getCore();b("CSS").conditionClass(b("DOM").find(this._root,".placeIcon"),"hasPlace",!!a);a?d.select(a):d.reset();c||this._save()};c.addPlaceSelectHandler=function(a){this._placesDataListener.push(this._placesTypeahead.subscribe("select",a))};c.mapEventNameToNamespace=function(a){return a+(this._editorId?"/"+this._editorId:"")};c.setDate=function(a,c){__p&&__p();if(this._hasExistingDateValue)return;var d=!a;a=a;if(d){if(!this._hasTimeTaken)return;a=Math.round(this._photoData.timeTaken/600)*600*1e3}var e=b("DOM").find(this.getRoot(),".uiProgressiveDatepicker");e=b("ProgressiveDatepicker").getInstance(e);e.setDateWithTimestamp(a);b("CSS").conditionClass(b("DOM").find(this._root,".dateIcon"),"hasDate",!!a);d&&this._saveDate(c)};c._doRemove=function(){b("DOM").remove(this._root),this._unsubscribeAll(),b("Arbiter").inform(this.mapEventNameToNamespace("PhotosBulkEditablePhoto.REMOVED"),this)};c._unsubscribeAll=function(){this._listeners.forEach(function(a){a.remove()}),this._listeners=[],this._placesDataListener.forEach(function(a){this._placesTypeahead.unsubscribe(a)}.bind(this)),this._placesTypeahead.getCore().unsubscribe(this._placesInputBlurListener)};c._handleClick=function(a){a=a.getTarget();if(b("Parent").byClass(a,"confirmPhotoBackdate")){this._saveDate();return}if(!b("Parent").byClass(a,"metaIcon"))return;b("CSS").addClass(this._root,"showControls");b("Parent").byClass(a,"placeIcon")?(this._showMetadataInput("place"),b("Focus").set(this._placesTypeahead.getCore().getElement())):b("Parent").byClass(a,"dateIcon")?this._showMetadataInput("date"):b("Parent").byClass(a,"peopleIcon")?(b("Arbiter").inform(this.mapEventNameToNamespace("PhotosBulkEditablePhoto.TAG_BUTTON_CLICKED"),this),this._showMetadataInput("people")):b("CSS").removeClass(this._root,"showControls")};c.hideMetadataInputs=function(){this._showMetadataInput()};c._showMetadataInput=function(a){["people","date","place"].forEach(function(c){b("CSS").conditionClass(this._metadataInputs,c,a==c)}.bind(this))};c._captionFocus=function(a){this.hideMetadataInputs(),b("CSS").addClass(this._root,"focusedInput")};c.remove=function(){var a={fbid:this._photoData.fbid,version:b("PhotosConst").BULK_EDITOR,confirmed:!0};new(b("Dialog"))().setTitle(i._("Delete Photo")).setBody(i._("Are you sure you want to delete this photo?")).setButtons(b("Dialog").OK_AND_CANCEL).setModal(!0).setHandler(function(){b("CSS").addClass(this._root,"editablePhotoWillBeRemoved"),new(b("AsyncRequest"))().setURI("/ajax/photos/photo/delete/dialog.php").setData(a).setHandler(function(a){a.getPayload().success?this._doRemove():b("CSS").removeClass(this._root,"editablePhotoWillBeRemoved")}.bind(this)).setErrorHandler(function(a){b("CSS").removeClass(this._root,"editablePhotoWillBeRemoved"),b("AsyncResponse").defaultErrorHandler(a)}.bind(this)).send()}.bind(this)).show()};c._setAlbumCover=function(){var a={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,fbid:this._photoData.fbid,owner:this._photoData.owner};a=new(b("AsyncRequest"))().setURI("/ajax/photos/album/setcover/").setData(a).setAllowCrossPageTransition(!1);b("AsyncDialog").send(a)};c._move=function(){var a={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,datakey:this._photoDataKey,fbid:this._photoData.fbid,owner:this._photoData.owner};a=new(b("AsyncRequest"))().setURI("/ajax/photos/photo/move/dialog.php").setData(a).setAllowCrossPageTransition(!1);b("AsyncDialog").send(a)};c._timeclose=function(a,b){a=a||0;b=b||0;return Math.abs(a-b)<43200};c._placesFocus=function(a){b("CSS").addClass(this._root,"focusedInput");a=b("DOM").scry(this._root,"input.latitude")[0];var c=b("DOM").scry(this._root,"input.longitude")[0],d=b("DOM").scry(this._root,"input.takentime")[0];d=d?b("Input").getValue(d):null;var e=this._placesTypeahead.getData(),f=e.getBootstrapData(),g={};a&&c?(g={latitude:b("Input").getValue(a),longitude:b("Input").getValue(c),proximity_boost:"true",city_id:null,search_time:d},e.setQueryData(g,!1),(!b("PlaceUtils").placesClose(f.latitude,f.longitude,g.latitude,g.longitude)||!this._timeclose(f.search_time,g.search_time))&&e.setBootstrapData(g,!1).setBootstrapEndpoint(e.getQueryEndpoint())):(g={latitude:null,longitude:null,proximity_boost:null,city_id:null,search_time:d},j&&(j.city_id?g.city_id=j.city_id:j.latitude&&j.longitude&&(g.latitude=j.latitude,g.longitude=j.longitude)),e.setQueryData(g,!1),!l?e.setBootstrapData(g).resetBootstrapEndpoint(!0):(!b("PlaceUtils").placesClose(f.latitude,f.longitude,g.latitude,g.longitude)||!this._timeclose(f.search_time,g.search_time))&&e.setBootstrapData(g,!1).resetBootstrapEndpoint())};c._saveDate=function(a){var c=b("DOM").find(this._root,"div.backdateInput"),d=b("Form").serialize(c);d.source=b("PhotosConst").BULK_EDITOR;d.fbid=this._photoData.fbid;d.version=b("PhotosConst").BULK_EDITOR;d.bulk=!!a;b("CSS").addClass(c,"backdating");new(b("AsyncRequest"))().setURI("/ajax/photos/photo/backdate/").setData(d).setRelativeTo(this._root).send()};c._save=function(){__p&&__p();b("CSS").removeClass(this._root,"focusedInput");var a=b("Form").serialize(this._root);if(this._previousSaveData){var c=!1;for(var d in a){if(d!=="caption"&&d!=="location"&&d!=="location_data")continue;a[d]!==this._previousSaveData[d]&&(c=!0,this._previousSaveData[d]=a[d])}if(!c)return}a.source=b("PhotosConst").BULK_EDITOR;a.bulk=!this._hasOwnPlaceValue;new(b("AsyncRequest"))().setURI("/ajax/photos/metadata/save/").setData(a).setAllowCrossPageTransition(!0).send()};c._setLoadingIndicator=function(a){b("CSS").conditionClass(this._root,"_2sfl",a)};c._rotate=function(a){var c=this,d={fbid:this._photoData.fbid,cs_ver:b("PhotosConst").BULK_EDITOR,editor_id:this._editorId,published:this._published,showMove:this._showMove};d[a]=1;this._setLoadingIndicator(!0);new(b("AsyncRequest"))("/ajax/photos/photo/rotate/").setData(d).setHandler(function(a){b("DOM").replace(c._root,a.getPayload()),c._unsubscribeAll(),b("Arbiter").inform(c.mapEventNameToNamespace("PhotosBulkEditablePhoto.ROTATED"),c)}).setFinallyHandler(function(){c._setLoadingIndicator(!1)}).setMethod("POST").send();return!1};return a}();e.exports=a}),null);
__d("PhotosBulkEditablePhotoPlaceholder",["csx","CSS","DOM","Event","mixInEventEmitter"],(function(a,b,c,d,e,f,g){__p&&__p();a=function(){"use strict";__p&&__p();function a(a,b,c){this._root=a,this._progressBar=b,this._uploadID=c,this._initAndGetGatedButton("._3273","cancelButtonClicked"),this._retryButton=this._initAndGetGatedButton("._3p03","retryButtonClicked"),this._errorOkayButton=this._initAndGetGatedButton("._8qx","dismissPlaceholder"),this._errorCloseButton=this._initAndGetGatedButton("._8qy","dismissPlaceholder")}var c=a.prototype;c._initAndGetGatedButton=function(a,c){var d=this;a=b("DOM").scry(this._root,a);if(a.length){a=a[0];b("Event").listen(a,"click",function(){return d.emit(c,d._uploadID)});return a}};c.getProgressBar=function(){return this._progressBar};c.getRoot=function(){return this._root};c.hide=function(){b("CSS").hide(this._root)};c.show=function(){b("CSS").show(this._root)};c.showRetryButton=function(){this._retryButton&&b("CSS").show(this._retryButton)};c.showErrorOkayButton=function(){this._errorOkayButton&&b("CSS").show(this._errorOkayButton)};c.showErrorCloseButton=function(){this._errorCloseButton&&b("CSS").show(this._errorCloseButton)};return a}();b("mixInEventEmitter")(a,{cancelButtonClicked:!0,retryButtonClicked:!0,dismissPlaceholder:!0});e.exports=a}),null);
__d("XPhotoBatchEditLocationController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/photos/edit/batch/location/",{})}),null);
__d("PhotosBulkEditor",["ix","xuiglyph","ActorURI","Arbiter","AsyncRequest","Button","CSS","DOM","Event","PageTransitions","Parent","PhotosConst","SortableGroup","XPhotoBatchEditLocationController","createIxElement","cxMargin","emptyFunction","mapObject"],(function(a,b,c,d,e,f,g,h){__p&&__p();var i,j={ASCENDING:"ascending",DESCENDING:"descending",MANUAL:"manual"},k={ascending:g("89980"),descending:g("89944")};a=function(){"use strict";__p&&__p();function a(a,c,d,e,f,g,h,i,j){__p&&__p();this.source=a;if(!c)return;this._root=c;this._reorderButton=b("DOM").scry(this._root.parentNode,"button.reorderButton").pop();this._id=c.getAttribute("id");this._ownerID=j;this._photos={};this._tagger=null;this._options=h;this._isNamespaced=i;this._placeholder=f;this._waitingTemplate=g;this._mentionsData=d;this._placesData=e;this._albumPlace=null;this._userDate=null;this._useDateFromFile=!1;this._albumCoverListeners={};this._albumCoverTracksFirstPhoto=this.source===b("PhotosConst").FLASH_UPLOADER;this._coverPhotoSortingID=null;h.canReorder&&this._initSorting(h.autosaveReorder);var k=[b("Arbiter").subscribe(this.mapEventNameToNamespace("PhotosBulkEditablePhoto.INITIALIZED"),this._registerPhoto.bind(this)),b("Arbiter").subscribe([this.mapEventNameToNamespace("PhotosBulkEditablePhoto.REMOVED"),this.mapEventNameToNamespace("PhotosBulkEditablePhoto.ROTATED")],function(a,b){if(this._sortableGroup){a=b.getPhotoData().fbid;this._sortableGroup.removeSortable(a)}delete this._photos[b.getPhotoDataKey()]}.bind(this)),b("Arbiter").subscribe("PhotosBulkEditor.AUTO_ORDER",this._autoOrder.bind(this)),b("Arbiter").subscribe("PhotosBulkBackdateEditor.SAVED",function(a,b){this._useDateFromFile=b.useDateFromFile,this._userDate=b.backdatedDate,this._setDate()}.bind(this)),b("Arbiter").subscribe(["PhotoAlbumPlacesTypeahead.SELECTED_PLACE","PhotoAlbumPlacesTypeahead.EXIST_PLACE","PhotoAlbumPlacesTypeahead.RESET_PLACE"],this._setPlace.bind(this)),b("Arbiter").subscribe("PhotosBulkEditablePhoto.MOVED",function(a,b){this.getPhotoData(b)&&this._photos[b]._doRemove()}.bind(this))];b("Event").listen(this._root,"click",function(a){var c=b("Parent").byClass(a.getTarget(),"editablePhoto"),d=this._photos;b("DOM").scry(this._root,".showControls").forEach(function(a){c!==a&&(b("CSS").removeClass(a,"showControls"),d[a.id].hideMetadataInputs())})}.bind(this));b("PageTransitions").registerHandler(function(){k.forEach(function(a){a.unsubscribe()}),this._tagger&&this._tagger.done()}.bind(this))}var c=a.prototype;c.init=function(b,c,d,e,f,g){a.call(this,this.source,b,c,d,e,f,g)};c.getRoot=function(){return this._root};c.getSourceString=function(){if(this.source===b("PhotosConst").BULK_EDITOR)return"bulk_editor";else if(this.source===b("PhotosConst").FLASH_UPLOADER)return"flash_uploader";else return null};c.isNamespaced=function(){return this._isNamespaced};c.getVersionConst=function(){return this.source};c.getViewerSource=function(){return null};c.getViewerSet=function(){return null};c.registerTagger=function(a){this._tagger=a};c.needTaggingData=function(){return this._tagger&&this._tagger.needTaggingData()};c.getPhotoData=function(a){a=this._photos[a];return a?a.getPhotoData():{}};c.getPlaceholder=function(){return this._placeholder};c.getWaitingTemplate=function(){return this._waitingTemplate};c.addFaceboxes=function(a){this._tagger&&this._tagger.addFaceboxes(a)};c.mapEventNameToNamespace=function(a){return a+(this._isNamespaced?"/"+this._id:"")};c._registerPhoto=function(a,b){__p&&__p();this._setSortMode(j.MANUAL);this._photos[b.getPhotoDataKey()]=b;b.source=this.source;a=b.getPhotoData();var c=a.fbid;this._sortableGroup&&this._sortableGroup.addSortable(c,b.getRoot(),b.getDragHandle());b.swapData(this._mentionsData,this._placesData);this._sortableGroup&&b.addPlaceSelectHandler(function(){this._sortableGroup.killDrag(c)}.bind(this));this._albumPlace&&!b.hasOwnPlaceValue()&&b.setAlbumPlace(this._albumPlace);this._sortableGroup&&this._albumCoverTracksFirstPhoto&&(this._coverPhotoSortingID=this._sortableGroup.getOrder()[0])};c._recoverPhotos=function(a){a=this._photos;for(var c in a){var d=a[c];this._tagger.recoverPhoto(d);b("CSS").addClass(d.getRoot(),"showRecognitionBoxes");d=b("DOM").find(d.getRoot(),"div.uiScaledImageContainer.scaledImage");this.addFaceboxes(d)}};c._initSorting=function(a){__p&&__p();var c=this;this._setSortMode(j.MANUAL);this._dropCallback=function(d,e,f){__p&&__p();d=c._photos[e.id].getPhotoData();e={order:c._sortableGroup.getOrder(),owner:d.owner};if(a){var g;d.set?(e.set=d.set,g="/ajax/photos/sets/static/reorder.php"):(e.album_fbid=d.albumFBID,g="/ajax/photos/reorder.php");new(b("AsyncRequest"))(g).setData(e).send()}if(c._sortableGroup&&c._albumCoverTracksFirstPhoto&&c._coverPhotoSortingID!==e.order[0]){d=c._photos[c._sortableGroup.sortables[e.order[0]].id];d&&c._makeAlbumCover(d);c._coverPhotoSortingID=e.order[0]}f||c._setSortMode(j.MANUAL)};this._sortableGroup=new(b("SortableGroup"))().setDropCallback(this._dropCallback).setBeforeGrabCallback(function(){b("Arbiter").inform(c.mapEventNameToNamespace("PhotosBulkEditor.PHOTO_REORDER_START"))})};c._compare=function(a,b){switch(this._sortMode){case j.MANUAL:return this._orderLookup[a.fbid]<this._orderLookup[b.fbid];case j.ASCENDING:return a.timeTaken<b.timeTaken;case j.DESCENDING:return a.timeTaken>b.timeTaken;default:throw new Error("Invalid sort mode")}};c._setSortMode=function(a){if(!this._reorderButton)return;this._sortMode=a;var c=null,d=a!==j.MANUAL;d&&(c=b("createIxElement")(k[a]),b("CSS").addClass(c,"_3-8_"));b("Button").setDepressed(this._reorderButton,d);b("Button").setIcon(this._reorderButton,c)};c._autoOrder=function(){__p&&__p();switch(this._sortMode){case j.MANUAL:var a,c,d=this.getOrder();this._orderLookup={};for(c=0;c<d.length;c++)a=d[c],this._orderLookup[a]=c;this._setSortMode(j.ASCENDING);break;case j.ASCENDING:this._setSortMode(j.DESCENDING);break;case j.DESCENDING:this._setSortMode(j.MANUAL);break;default:throw new Error("Invalid sort mode")}a=this._sortableGroup.getOrder().map(function(a){return this._photos["editablePhoto_"+a].getPhotoData()}.bind(this));this._sortableGroup.setDropCallback(b("emptyFunction"));var e;for(c=0;c<a.length;c++){d=c;for(e=c+1;e<a.length;e++)this._compare(a[e],a[d])&&(d=e);if(c!==d){e=a[d].fbid;var f=a[c].fbid;this._sortableGroup.dragOverHandler(f,e);this._sortableGroup.dropHandler(e);a.splice(c,0,a.splice(d,1)[0])}}f=Object.keys(this._photos)[0];e=this._photos[f];this._dropCallback(e.getPhotoData().fbid,e.getRoot(),!0);this._sortableGroup.setDropCallback(this._dropCallback)};c._saveCurrentOrder=function(){__p&&__p();if(this._photos.length===0)return;var a=this._sortableGroup.getOrder()[0];a=this._photos["editablePhoto_"+a]||this._photos["photoContainer_"+a];if(!a)return;a=a.getPhotoData();if(!a.albumFBID)return;a={order:this._sortableGroup.getOrder(),owner:a.owner,album_fbid:a.albumFBID};new(b("AsyncRequest"))("/ajax/photos/reorder.php").setData(a).send()};c._setPlace=function(a,c){__p&&__p();this._albumPlace=c||null;var d=this._options.batchUpdateLocation,e=[];(i||(i=b("mapObject")))(this._photos,function(a,b){if(a.hasOwnPlaceValue())return;a.setAlbumPlace(this._albumPlace,d);d&&e.push(a.getPhotoData().fbid)},this);if(d){a=b("XPhotoBatchEditLocationController").getURIBuilder().getURI();this._ownerID&&(a=b("ActorURI").create(a,this._ownerID));new(b("AsyncRequest"))(a).setData({photo_ids:e,location:this._albumPlace?this._albumPlace.text:"",location_data:this._albumPlace?this._albumPlace.uid:0}).send()}};c._setDate=function(){var a,b=null,c;for(var d in this._photos)c=this._photos[d],this._useDateFromFile||(a=this._userDate.month+"/"+this._userDate.day+"/"+this._userDate.year,b=new Date(a).getTime()),c.setDate(b,!0)};c._showAlbumCoverSet=function(a){this._albumCover&&b("CSS").removeClass(this._albumCover,"checked");a=b("DOM").find(a.getRoot(),".albumCover");b("CSS").addClass(a,"checked");this._albumCover=a};c._makeAlbumCover=function(a){new(b("AsyncRequest"))().setURI("/ajax/photos/album/setcover").setData(a.getPhotoData()).send()};c.getOrder=function(){if(this._sortableGroup)return this._sortableGroup.getOrder();else return[]};c.hasOrder=function(){return!!this._sortableGroup};return a}();e.exports=a}),null);
__d("PhotosBulkHeader",["fbt","ActorURI","Arbiter","AsyncRequest","DOM","Event","Form","Run","areJSONRepresentationsEqual","gkx","goURI"],(function(a,b,c,d,e,f,g){__p&&__p();a=function(){"use strict";__p&&__p();function a(a,c,d,e,f){__p&&__p();var h=this;this._backdatedTime=null;this._initialData=null;this._listeners=[];this._form=a;this._formRoot=a!=null&&typeof a.getRoot==="function"?a.getRoot():null;this._isAlbum=c;this._editable=d;this._audience=e;this._actorID=f;b("Arbiter").subscribe("PhotosBulkBackdateEditor.SAVED",function(a,c){if(!b("DOM").contains(h._formRoot,c.context))return;h._backdatedTime=c.backdatedDate});b("Run").onBeforeUnload(function(){return this.isDataDirty()?g._("Some of your changes have not been saved. Would you like to save your changes now?"):void 0}.bind(this));this._initialData=this.getSerializedData()}var c=a.prototype;c.getSerializedData=function(){var a=b("Form").serialize(this._formRoot);this._backdatedTime&&(a.backTime=this._backdatedTime);return a};c.isDataDirty=function(){return!b("areJSONRepresentationsEqual")(this._initialData,this.getSerializedData())};c.save=function(a){__p&&__p();if(!this._editable)return a.call();this._audience&&this._audience.removeHiddenPrivacyWidget&&this._audience.removeHiddenPrivacyWidget();var c=this._isAlbum?"/ajax/photos/album/edit":"/ajax/photos/sets/edit";this._actorID&&(c=b("ActorURI").create(c,this._actorID.toString()));var d=b("Form").serialize(this._formRoot);this._backdatedTime&&(d.backdated_time=this._backdatedTime);var e=this._audience;if(e!=null&&b("gkx")("777107"))if(e.isSharedSelectorActive()){var f,g=b("Form").serialize(e.getSharedPrivacyWidget());d.shared_album_privacyx=(f=g==null?void 0:(f=g.privacy)==null?void 0:f[0])!=null?f:g==null?void 0:g.privacyx}else{f=b("Form").serialize(e.getNormalPrivacyWidget());d.privacyx=(g=f.privacyx)!=null?g:(e=f.privacy)==null?void 0:e[0]}new(b("AsyncRequest"))(c).setData(d).setMethod("POST").setHandler(function(){this._initialData=this.getSerializedData(),a()}.bind(this)).send()};a.doneButtonSaveHandler=function(a,c,d){var e=a.save.bind(a,function(){b("goURI")(c,!0);return!0});a._listeners=[b("Event").listen(d,"click",e)]};return a}();e.exports=a}),null);
__d("PlacesTypeaheadBehavior",["CSS","DOM"],(function(a,b,c,d,e,f){a={init:function(a,c){a.subscribe(["reset","select","highlight"],function(a,d){a==="highlight"&&d.index!==-1&&d.selected.type!="freeform"&&d.selected.map&&!d.selected.changeCity?(b("DOM").setContent(c,d.selected.map),b("CSS").show(c)):b("CSS").hide(c)})}};e.exports=a}),null);
__d("NoTrucatingCompactTypeaheadRenderer",["CompactTypeaheadRenderer"],(function(a,b,c,d,e,f){function a(a,c){return b("CompactTypeaheadRenderer")(a,c)}a.className="noTrucating compact";e.exports=a}),null);
__d("FreeformTokenizerBehavior",["Event","Input","Keys"],(function(a,b,c,d,e,f){__p&&__p();function a(a,c){__p&&__p();var d=c.matcher&&new RegExp(c.matcher,"i"),e=c.splitter&&new RegExp(c.splitter),f=c.tokenize_on_blur!==!1,g=c.tokenize_on_paste!==!1,h=c.split_on_check===!0,i=c.select_on_comma!==!1,j=c.select_on_space===!0,k=c.never_submit===!0;function l(c){__p&&__p();var f=b("Input").getValue(a.getInput()).trim();e&&c&&c.type=="paste"?f=f.split(e):e&&h?f=f.split(e):f=[f];var g=!1;for(var i=0;i<f.length;i++){var j=f[i].trim();if(j&&(!d||d.test(j))){j={uid:j,text:j,freeform:!0};a.addToken(a.createToken(j));g=!0}}c&&g&&(a.getTypeahead().getCore().afterSelect(),c.kill())}a.subscribe("keydown",function(c,d){c=d.event;d=b("Event").getKeyCode(c);if(d==b("Keys").RETURN||i&&d==b("Keys").COMMA||j&&d==b("Keys").SPACE){var e=a.getTypeahead().getView();e.getSelection()?(e.select(),c.kill()):l(c)}d==b("Keys").RETURN&&k&&c.kill()});a.subscribe("paste",function(a,b){g&&setTimeout(l.bind(null,b.event),20)});a.subscribe("blur",function(b,c){f&&l(),a.getTypeahead().getCore().reset()})}e.exports=a}),null);
__d("legacy:ShowResultsOnFocusTypeaheadBehavior",["TypeaheadShowResultsOnFocus"],(function(a,b,c,d,e,f){a.TypeaheadBehaviors||(a.TypeaheadBehaviors={}),a.TypeaheadBehaviors.showResultsOnFocus=function(a){a.enableBehavior(b("TypeaheadShowResultsOnFocus"))}}),3);