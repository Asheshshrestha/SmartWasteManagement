if (self.CavalryLogger) { CavalryLogger.start_js(["Pbig\/"]); }

__d("ChatTabPolicy",["BanzaiODS","ChatBehavior","ChatOptions","ChatSidebarDropdownConstants","CurrentUser","LogHistory","MercuryAssert","MercuryIDs","MercuryIgnoredBlockedParticipants.bs","MercuryThreadActions","MercuryThreadInfo","MercuryViewer","MessagingTag","MessengerState.bs","PresencePrivacy","ShortProfiles","killswitch"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("MercuryThreadActions").get(),h=new Set(["1579802578966277","881263441913087","506060876211905"]),i=b("LogHistory").getInstance("tab_policy"),j=function(){return b("ChatOptions").getSetting(b("ChatSidebarDropdownConstants").TURN_OFF_CHAT_TABS)!==void 0};e.exports={messageIsAllowed:function(a,c,d){__p&&__p();if(j()&&b("ChatOptions").getSetting(b("ChatSidebarDropdownConstants").TURN_OFF_CHAT_TABS))return;var e=a.thread_id,f=c.message_id,k=b("MercuryIDs").getUserIDFromParticipantID(b("MercuryViewer").getID());b("MercuryAssert").isThreadID(e);b("MercuryAssert").isParticipantID(c.author);var l;if(b("MercuryThreadInfo").isMuted(a)){l={thread_id:e,message_id:f,mute_until:a.mute_until};i.log("message_thread_muted",JSON.stringify(l));if(!b("MercuryThreadInfo").areMentionsMuted(a)){if(!c.profile_ranges||!c.profile_ranges.some||!c.profile_ranges.some(function(a){return a.id===k})){i.log("message_mentions_viewer",JSON.stringify(l));return}}else return}if(a.read_only){l={thread_id:e,message_id:f};i.log("message_read_only",JSON.stringify(l));b("BanzaiODS").bumpEntityKey(3303,"messenger-chat-tab-policy","message_read_only");return}if(c.source=="source:email"||c.source=="source:titan:emailreply"){l={thread_id:e,message_id:f,source:c.source};i.log("message_source_not_allowed",JSON.stringify(l));b("BanzaiODS").bumpEntityKey(3303,"messenger-chat-tab-policy","message_source_not_allowed");return}var m=b("MercuryIDs").getUserIDFromParticipantID(c.author);if(!m){i.log("message_bad_author",JSON.stringify({thread_id:e,message_id:f,user:m}));b("BanzaiODS").bumpEntityKey(3303,"messenger-chat-tab-policy","message_bad_author");return}if(c.action_type!="ma-type:user-generated-message"&&!this._messageIsNewlyCreatedGroup(c,a)){l={thread_id:e,message_id:f,type:c.action_type};i.log("message_non_user_generated",JSON.stringify(l));this._messageIsNewlyCreatedGroup(c,a)&&b("BanzaiODS").bumpEntityKey(3303,"messenger-chat-tab-policy","message_non_user_generated_new_group_thread");return}if(a.is_canonical_user&&!b("ChatBehavior").notifiesUserMessages()){i.log("message_jabber",JSON.stringify({thread_id:e,message_id:f}));g.markSeen(e,!0);b("BanzaiODS").bumpEntityKey(3303,"messenger-chat-tab-policy","message_jabber");return}if(a.is_canonical&&!a.other_user_fbid){i.log("message_canonical_contact",JSON.stringify({thread_id:e,message_id:f}));b("BanzaiODS").bumpEntityKey(3303,"messenger-chat-tab-policy","message_canonical_contact");return}if(a.folder!=b("MessagingTag").INBOX){i.log("message_folder",JSON.stringify({thread_id:e,message_id:f,folder:a.folder}));return}var n=b("CurrentUser").getID();b("MessengerState.bs").compute(n,function(c){__p&&__p();c=c.blocked_ids;if(b("MercuryIgnoredBlockedParticipants.bs").isPresentInGroupThread(n,c,a)){l={thread_id:e,message_id:f};i.log("message_blocked_participants",JSON.stringify(l));return}if(k==null)return;b("ShortProfiles").getMulti([m,k],function(a){__p&&__p();if(!j()&&!b("PresencePrivacy").allows(m)){i.log("message_privacy",JSON.stringify({thread_id:e,message_id:f,user:m}));return}var c=a[m].employee&&a[k].employee,g=b("CurrentUser").isWorkUser();if(!c&&!g&&!a[m].isCommercePage&&!h.has(m)&&a[m].type!=="friend"&&a[m].type!=="page"){i.log("message_non_friend",JSON.stringify({thread_id:e,message_id:f,user:m}));return}if(b("killswitch")("MESSENGER_WEB_STOP_AUTOMATIC_CHAT_TAB_RAISING")){i.log("chat_tab_automatic_popup_killswitch",JSON.stringify({thread_id:e,message_id:f,user:m}));return}d()})})},_messageIsNewlyCreatedGroup:function(a,b){return a.action_type==="ma-type:log-message"&&a.log_message_type==="log:thread-name"&&b.message_count===1}}}),null);
__d("XCRMUpdateAdAccountDescriptionController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/crm/async/ad_account/{ad_account_info_id}/description/update/",{ad_account_info_id:{type:"Int",required:!0}})}),null);