if (self.CavalryLogger) { CavalryLogger.start_js(["npASl"]); }

__d("UserContentWrapperUtils",["csx","cx"],(function(a,b,c,d,e,f,g,h){"use strict";a={getAllStrings:function(){return["userContentWrapper","fbUserContent","fbUserPost","fbUserStory","fbUserFeedStory","fbUserFeedStoryWrapper","fbFeedStory","fbFeedStoryWrapper"]},getCXLagging:function(){return"fbUserPost"},getCSXLagging:function(){return"fbUserPost"}};e.exports=a}),null);
__d("TextDelightController",["Arbiter","ContextualComponent","DelightsTextTriggerTypedLogger","DOM","Event","PageTransitionsRegistrar","Parent","SubscriptionsHandler","TextDelightConfig","TextDelightLoader","UserContentWrapperUtils","containsNode","createCancelableFunction","ge","promiseDone","throttle"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("TextDelightConfig").options,h=1e3;a=250;var i=0,j=new Set();b("Arbiter").subscribe("pre_page_transition",function(){j.forEach(function(a){a.getRenderer().pause(),b("DOM").remove(a.getElement())}),j.clear()});b("Event").listen(window,"resize",b("throttle")(function(){j.forEach(function(a){return a.needsReposition()})},a));function k(a,b){__p&&__p();for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;e=b(e);if(e)return e}return null}function l(a,c){a=c.text;b("TextDelightLoader").findAndLoadKeywords(a,"comment")}function m(a,c){a=c.text;b("TextDelightLoader").findAndLoadKeywords(a,"post")}function n(){g.enabledPreloadSurfaces.post&&b("Arbiter").subscribe("potential_delight_in_post",b("throttle")(m,h)),g.enabledPreloadSurfaces.comment&&b("Arbiter").subscribe("potential_delight_in_comment",b("throttle")(l,h))}var o={init:function(){n()},playAnimation:function(a,c){i++,b("promiseDone")(b("TextDelightLoader").load(a,c),function(a){j.has(a)||(b("DOM").appendContent(document.body,a.getElement()),j.add(a)),a.getRenderer().onRepeatEnd(function(){a.hide()}).seekToProgress(0).play(),a.show(),i--})},attachClickListener:function(a,c,d,e,f){__p&&__p();var g=k([].concat(b("UserContentWrapperUtils").getAllStrings(),["photoUfiContainer","uiContextualLayerParent"]),function(c){return b("Parent").byClass(a,c)}),h;g&&(h=b("Event").listen(g,"mousemove",function(a){b("TextDelightLoader").load(c,e),h&&(h.remove(),h=null)}));var i=b("Event").listen(a,"click",function(){__p&&__p();o.playAnimation(c,e);var a="delights_text_trigger_post_tapped";switch(e){case"post":a="delights_text_trigger_post_tapped";break;case"comment":a="delights_text_trigger_comment_tapped";break;case"story":a="delights_text_trigger_story_tapped";break}new(b("DelightsTextTriggerTypedLogger"))().setEvent(a).setCampaignID(c).setKeyword(d).log();f&&f()}),j=!1;return{remove:function(){if(j)return;j=!0;i.remove();h&&h.remove()}}},waitForElementToAttachListeners:function(a,c,d){__p&&__p();var e=new(b("SubscriptionsHandler"))(),f=b("createCancelableFunction")(function(){e.release()});e.addSubscriptions(f);var g;function h(a){g=a;e.addSubscriptions(o.attachClickListener(a,c,d,"post"));a=b("ContextualComponent").closestToNode(a);a&&a.onCleanup(f)}var i=b("ge")(a);if(i)h(i);else{var j=b("Arbiter").subscribe(["ConversationNubUtils/recheckTabVisibility","LitestandComposer/attachedToDOM"],function(c,d){__p&&__p();var e;switch(c){case"ConversationNubUtils/recheckTabVisibility":c=d==null?void 0:d.tab;e=c&&c.getRootDOM();break;case"LitestandComposer/attachedToDOM":c=d;e=b("ge")(c);break;default:return null}if(e!=null){d=b("ge")(a);b("DOM").contains(e,d)&&(h(d),j.unsubscribe())}});e.addSubscriptions(j)}i=b("createCancelableFunction")(function(){if(g==null)return;b("containsNode")(document.documentElement,g)===!1&&f()});e.addSubscriptions(i);b("PageTransitionsRegistrar").registerCompletionCallback(i);e.addSubscriptions(b("Arbiter").subscribe("ConversationNub/destroy",i))},stopAnimation:function(){j.forEach(function(a){a.getRenderer().isPlaying()&&a.hide()})},animationPlaying:function(){if(i>0)return!0;var a=0;j.forEach(function(b){b.getRenderer().isPlaying()&&a++});return a>0?!0:!1}};e.exports=o}),null);