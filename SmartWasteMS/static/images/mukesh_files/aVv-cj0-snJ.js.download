if (self.CavalryLogger) { CavalryLogger.start_js(["c1UNP"]); }

__d("DOMScanner",["AsyncRequest","DataAttributeUtils","Run","URI","XDOMScannerResultsController"],(function(a,b,c,d,e,f){__p&&__p();var g,h={results:[],local_storage:[],found_blacklisted_dom_element:!1,blacklist:[],ad_divs:[],scan_id:0,runtime:0,fb_domains_sampling_rate:.25,scheduleScan:function(a,c,d){var e=this;b("Run").onAfterLoad(function(){setTimeout(h.runScan.bind(h),a),e.blacklist=d,e.scan_id=c})},runScan:function(){var a=new Date();this.checkScripts();this.checkAs();this.checkIframes();this.checkImgs();this.checkAdDivs();this.checkLocalStorage();this.runtime=new Date()-a;this.sendResponse()},isDataUri:function(a){return a.startsWith("data:")&&a.contains(";base64,")},isForeignDomain:function(a){a=new(g||(g=b("URI")))(a);a=a.getDomain();return!(a.endsWith("fbcdn.net")||a.endsWith("facebook.com")||a.endsWith("facebook.net"))},shouldLog:function(a){return this.isDataUri(a)?!1:this.isForeignDomain(a)||Math.random()<this.fb_domains_sampling_rate},checkScripts:function(){__p&&__p();var a=document.getElementsByTagName("script");for(var b=0;b<a.length;++b){var c=a[b];if(c.src&&this.shouldLog(c.src)){var d=c.src,e=null,f=null,g=null;c.className&&(e=c.className);c.id&&(f=c.id);c=["script",d,f,e,g];this.results.push(c)}}},checkAs:function(){__p&&__p();var a=document.getElementsByTagName("a");for(var b=0;b<a.length;++b){var c=a[b];if(c.href&&this.shouldLog(c.href)){var d=c.href,e=null,f=null,g=null;c.className&&(e=c.className);c.id&&(f=c.id);c=["a",d,f,e,g];this.results.push(c)}}},checkIframes:function(){__p&&__p();var a=document.getElementsByTagName("iframe");for(var b=0;b<a.length;++b){var c=a[b];if(c.src&&this.shouldLog(c.src)){var d=c.src,e=null,f=null,g=c.getBoundingClientRect();g=JSON.stringify({src:c.src,size:{h:c.height,w:c.width},position:{t:g.top,b:g.bottom,l:g.left,r:g.right},visibility:c.style.visibility},null,2);c.className&&(e=c.className);c.id&&(f=c.id);c=["iframe",d,f,e,g];this.results.push(c)}}},checkImgs:function(){__p&&__p();var a=document.getElementsByTagName("img");for(var b=0;b<a.length;++b){var c=a[b];if(c.src&&this.shouldLog(c.src)){var d=c.src,e=null,f=null,g=c.getBoundingClientRect();g=JSON.stringify({src:c.src,size:{h:c.height,w:c.width},position:{t:g.top,b:g.bottom,l:g.left,r:g.right},visibility:c.style.visibility},null,2);c.className&&(e=c.className);c.id&&(f=c.id);c=["img",d,f,e,g];this.results.push(c)}}},checkAdDivs:function(){var a=document.getElementsByTagName("div");for(var c=0;c<a.length;++c){var d=a[c],e=b("DataAttributeUtils").getDataAttribute(d,"data-ad");if(e){this.ad_divs.push(e);this.checkRecursiveAds(d);continue}}},checkRecursiveAds:function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];this.checkRecursiveAds(c);if(this.extractAd(c))return}},extractAd:function(a){__p&&__p();var b=a.innerHTML;if(b){b=b.split(' onmouseover="LinkshimAsyncLink.swap(this, &quot;');if(b.length>=2){b=b[1];b=b.split('&quot;);" onmousedown=');b&&(b=b[0],this.ad_divs.push(b));return!0}else if(a.className.indexOf("AdUnitTitle__subtitle")>-1){this.ad_divs.push(a.innerText);return!0}}return!1},checkLocalStorage:function(){if(!localStorage||!localStorage.length||!localStorage.key)return;for(var a=0;a<localStorage.length;++a)this.local_storage.push(localStorage.key(a))},sendResponse:function(){var a={scan_id:this.scan_id,results:JSON.stringify(this.results),fun_divs:this.ad_divs,local_storage:this.local_storage,found_blacklisted_dom_element:this.found_blacklisted_dom_element,runtime:this.runtime},c=b("XDOMScannerResultsController").getURIBuilder().getURI();new(b("AsyncRequest"))().setURI(c).setMethod("POST").setData(a).send()}};e.exports=h}),null);